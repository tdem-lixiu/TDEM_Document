航空TEM程序总结-曹华科
=======================

1.为什么视电阻率定义会得不到浅层的数据？
----------------------------------------
因为半正弦波和三角波以及梯形波都不是全频率域波形，因为它们没有相应的高频率成分，所以无法得到浅层的信息，
但值得注意的时，当梯形波的下降沿越窄时，其最大的高频成分就越多，可能得到的越浅层的信息；但是半正弦波和
三角波，它们的高频成分少，所以存在较大的穿透深度（建议看频谱分析），三角波和半正弦波的穿透深度差不多大
小。
解决方案：在开始时，先是定义前面的时间道，试出每种波形的相应穿透深度。

2.为什么K型地电模型时，当第一层和第三层的层厚、电阻率参数不变时，改变第二层的电阻率，正演曲线几乎重合或者视电阻率曲线几乎不变？
-----------------------------------------------------------------------------------------------------------------------------------
这种现象叫做瞬变电磁法的H等值线原理，但第二层的厚度比较薄时，第二层的电阻率在一定范围变化所引起的数据
变化会在5%以内，也就是说，在这种情况下，与第二层的电阻率变化无关，和第二层的厚度有关。
解决方案：增大第二层的厚度（这是关键），并提高第二层电阻率变化率（降低第一层和第三层的电阻率）

3.为什么第一层的电阻率不变的情况下，同一种波形的穿透深度会发生变化呢？
--------------------------------------------------------------------------
首先得明确视电阻率定义:它是将地下非均匀的地质体当作均匀大地处理的一种方法，容易受到第二层的影响，而瞬
变电磁法对低阻体灵敏而对高阻体不灵敏，所以当第二层是低阻时，其穿透深度大，而高阻时，其穿透深度可以视为
较小。关键是受到计算误差的影响，误差导致了视电阻率定义会有10%的波动。
那么具体的影响因素有哪些呢？
阶跃波的计算是基本上没误差的，误差主要出自于褶积运算，也就是高斯积分的运算部分。
解决方案：
各个波形的穿透深度与第一层的电阻率有着非常大的关系，在这里只提供一个大概的经验值：
对于10欧姆，半正弦和三角波的穿透深度在100m左右，而梯形波在50m左右；
对于100欧姆，半正弦和三角波的穿透深度在200m左右，而梯形波在100m左右
误差待解决！

4.为什么视电阻率定义晚期的时候误差会特别大，有多点跳跃？
--------------------------------------------------------------------------
正演存在一定的误差，尤其当选取的电阻率的跨度较大时，例如10，100，1000，会出现明显的跳跃，跨度过大导致的
误差会变大时因为里面的结果用了插值函数，由于2端固定，插值就会可能产生较大的波动
解决方案：选取跨度较小的电阻率。
可以利用 '平滑程序' 文件夹中的 main_抽样平滑插值.m 、 main_视电阻率平滑.m 、main_响应平滑.m
进行平滑处理

程序改进：
-------------------------------------
原程序自带的是ic=0到4的情况，其中0代表脉冲波，1代表下阶跃波，2代表半正弦波，3代表梯形波，4代表三角波，
他们的时间都是从on_time开始计算的。
输入说明：当为脉冲波是，仅输入：0
1.当为下阶跃波时，仅输入：1
2.当为半正弦波时，需输入：2

4.e-3 1.6e-2 2

这里换行代表在文件输入中是需要换行的，第二行第一个数据是on_time时间，第二个是off_time，第三个是波形个数；

3.当为梯形波时，需输入：3

0.1e-4 3.98e-3 0.1e-4 1.6e-2  1  !上升沿的时间 平缓的时间 下降沿的时间 关断时间 波形的个数

4.当为三角波时，需输入：4

2.e-3 2.e-3 1.6e-2 1  !三角波左半边的时间 三角波右半边的时间 关断时间 波形个数

5.ic=5和ic=6是本笔者根据需要自己添加的功能。当为ic=5是，代表的是矩形波，需输入：5

4.e-4 1.6e-3 2  !第一个是脉宽，第二个是波形的关断时间，第三个是波形个数

6.ic=6时，需输入：6

5.e-5 31

1	1	-1	-1	-1	1	1	1	1	1	-1	-1	1	1	-1	1	-1	-1	1	-1	-1	-1	-1	1	-1	1	-1	1	1	1	-1

其中第二行，第一个代表最小码元，第二个代表伪随机波的序列个数，第三行代表伪随机二进制码，参考文献是：

《多通道瞬变电磁m序列全时正演模拟与反演》、《MTEM波场变换与偏移成像方法研究_智庆全》
其中伪随机二进制码是利用 Produce pseudo-random code 的代码产生的。

上述说明皆属于ATEM modeling 1D-qiu的说明，它是属于一维正演，可以利用 ATEMAppRes_并行_批量处理 程序
进行下一步的操作，即视电阻率定义。

其中ic=6(即伪随机波)的视电阻率定义可以分为3种不同的方式进行定义：

1.直接将数据放入，进行伪随机定义

2.将伪随机波数据放入文件 '矩阵提取'中，利用其中的Matrix_extract.m的flag=1进行直接提取下阶跃波的数据。
然后在ATEMAppRes_并行_批量处理，程序用下阶跃波进行定义

3.将伪随机波数据放入文件 '矩阵提取'中，利用其中的Matrix_extract.m的flag=2进行泛函提取下阶跃波的数据。
然后在ATEMAppRes_并行_批量处理，程序用下阶跃波进行定义

1.ATEM1DFwd输入文件
-------------------------------------
::

  CENTRAL         !SEPARATE/CENTRAL !装置类型，CENTRAL是中心回线装置,SEPARATE是分离装置
  VMD             !VMD/HMD   !源的类型，VMD是垂直磁偶极子源,HMD是水平磁偶极子源
  30.0 30.0 100   !ALTITUDE OF TRANSMITTER/RECEIVER. Area.(中心回线装置)/收发距（分离装置），第一个是发射点的高度，第二个是接受点的高度，第三个分情况，如果是中心回线，则是有效面积，如果是分离装置，则是收发距
  1               !发射线圈匝数*电流强度
  801             !时间的道数
  ...             !具体的时间
  2               !层数，n层就给n
  10 20 0 0 0 1   !每一层的参数，有n层就有n行参数，其中第一个是电阻率，第二个是层厚，第三个是充电率，第四个是时间常数，第五个是频率系数，第六个是磁导率
  100 0 0 0 1     !最后一层由于厚度无限大，所以第二个参数直接省略了
  ic              !ic是0-6的整数，代表发射波类型，ic=0或者1时，输入就结束，ic=2-5，还有一行的波形参数输入，ic=6时，还有2行的波形参数说明，具体说明在上面

2.ATEM1DFwd输出文件
---------------------
本程序的输出文件为：result.TXT
文件说明：
::

  !----------------------------该部分全部为参数的说明--------------------------!

  装置类型是中心回线装置
  源的类型是垂直磁偶极子源.
  发射线圈高度是:    30.000m
  接收线圈高度是:    30.000m
  收发距是:     5.642m
  发射线圈磁矩是:          1.000Am^2
  时间道数是: 801
  各时间道分别是:
  层数是:   2
      电阻率    层厚     充电率   时间常数  频率系数  磁导率分别是:
      10.000    20.000     0.000     0.000     0.000     1.000
     100.000               0.000     0.000     0.000     1.000
  计算的波形是阶跃波形.
  !----------------------------该部分全部为参数的说明--------------------------!

正演结果:
::

      T(S)        DBXDT(nT/S)     DBZDT(nT/S)       BX(nT)          BZ(nT)
  3.1010000E-04   0.0000000E+00   4.6515568E+00   0.0000000E+00   7.8670657E-04
  3.1020000E-04   0.0000000E+00   4.6474861E+00   0.0000000E+00   7.8624160E-04
  3.1030000E-04   0.0000000E+00   4.6434120E+00   0.0000000E+00   7.8577717E-04
  3.1040000E-04   0.0000000E+00   4.6393473E+00   0.0000000E+00   7.8531300E-04

第一列为时间，后面的4列是各个响应分量

3.ATEMAppRes程序输入文件
------------------------
正演结果程序来进行视电阻率定义，其中ATEMAppRes的输入参数文件名为：model.txt
::

  #成像参数           !说明语句
  1  1000            !视电阻率成像的最小和最大的电阻率范围
  #初始模型参数       !说明语句
  1 层数             !初始模型的层数(一般不做修改)
  100 0 0 0 1  电阻率,充电率,时间常数,频率相关系数和磁导率  !初始模型的第一层参数(一般不做修改)，第一个是电阻率，第二个是层厚，第三个是充电率，第四个是时间常数，第五个是频率系数，第六个是磁导率，由于这里是最后一层，故第二个参数舍弃
  #系统参数           !说明语句
  SEPARATE           !SEPARATE/CENTRAL      !发射装置的类型,与正演保持一致
  VMD                !VMD/HMD                !源的类型,与正演保持一致
  30.0 50.0 30       !ALTITUDE OF TRANSMITTER/RECEIVER. Area.(中心回线装置)/收发距（分离装置） !与正演保持一样的参数，与正演保持一致
  706.858            !发射线圈匝数*电流强度,与正演保持一致
  1                  !发射波形,与正演保持一致
  #观测参数           !说明语句
  bz                 !观测分量dbxdt;dbzdt;bx;bz,视电阻率定义的分量，与下面给出的数据类型应一样
  1                  !测点数
  41                 !NUMBER OF TIME CHANNELS，每个观测点的时间道数
      T(S)                  Bz(nT)    !说明语句
  0.1000000E-02            0.1097899E+00    !第一列是时间，第二列是需要视电阻率定义的分量，可以直接从正演的结果中直接复制粘贴过去
  0.1258930E-02            0.1035520E+00    !共有：观测点数*每个点时间道数行的数据
  0.1584890E-02            0.9729680E-01
  0.1995260E-02            0.9103173E-01
  0.2511890E-02            0.8476936E-01
  0.3162280E-02            0.7850335E-01

4.ATEMAppRes程序输出文件
------------------------
程序中得到结果文件为：imgres.dat，输出参数文件说明：
::

  时间(s)        视电阻率(欧姆.米)     !说明语句
  0.004046       27.399505            !第一列是时间，第二列是定义出来的视电阻率
  0.004056       24.713108
  0.004066       22.674901
  0.004076       -1            !-1表示计算得到的值超过成像的最大或者最小范围或者超过迭代次数，在输出参数里面，-1处的值取为上一个值，并进行最小曲率插值
  0.004086       19.636782
